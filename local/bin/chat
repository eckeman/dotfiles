#!/bin/fish
if test -z "$chat_server"
  echo 'error: $chat_server not set'
  exit 1
end

set -l commands "mosh $chat_server -- tmux attach -t chat"

if test -z "$TMUX"
  tmux new -A -s chat "$commands; $SHELL -l"
else
  set -l sessions (tmux list-sessions | cut -d ':' -f 1 ^/dev/null)

  if not contains -- chat $sessions
    tmux if true "new -d -s chat '$commands; $SHELL -l'"
  end

  tmux switch -t chat
end
