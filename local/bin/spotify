#!/usr/bin/env bash
export SSH_ASKPASS=/usr/lib/ssh/x11-ssh-askpass

if command -v sshpass >/dev/null; then
	ssh_cmd='sshpass -p spotify ssh -q docker-spotify'
else
	ssh_cmd='ssh -q docker-spotify'
fi

if ! $ssh_cmd true; then
	echo -n 'Starting Spotify Server'
	systemctl --user start spotify

	until $ssh_cmd true; do
		echo -n '.'
		sleep 0.1
	done

	echo
fi

$ssh_cmd spotify-pulseaudio
